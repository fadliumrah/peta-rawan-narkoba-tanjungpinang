# Peta Rawan Narkoba - Kota Tanjungpinang

Sistem Informasi Geografis untuk memetakan area rawan narkoba di Kota Tanjungpinang dengan dashboard admin dan tampilan publik.

## ğŸš€ Fitur Utama

### Halaman User (Public)
- âœ… Tampilan logo BNN dan banner dinamis
- âœ… Peta interaktif dengan marker lokasi rawan narkoba
- âœ… Statistik per kelurahan dengan warna berbeda
- âœ… Daftar berita lengkap dengan pagination
- âœ… Detail berita dengan view counter
- âœ… Responsive design

### Halaman Admin
- âœ… Login sistem dengan JWT authentication
- âœ… **Kelola Admin** (Super Admin Only):
  - Tambah admin baru dengan validasi KTP 16 digit
  - Edit username dan nama admin
  - Reset password admin lain
  - Toggle aktif/nonaktif admin
  - Hapus admin (kecuali super admin)
  - **Super Admin Protection**: Hanya KTP 1308162101990001 yang dapat manage admin
- âœ… **Update Banner**: Upload gambar banner & edit caption
- âœ… **Update Logo BNN**: Upload logo dan edit informasi header
- âœ… **Kelola Titik Lokasi**:
  - Klik langsung di peta untuk pilih koordinat
  - Gunakan GPS device (dengan high accuracy)
  - Input manual koordinat
  - Kelola kelurahan, kecamatan, alamat
  - Warna marker otomatis per kelurahan
  - Drag & drop marker untuk reposisi
- âœ… **Kelola Berita**:
  - Rich text editor (Quill.js) dengan toolbar lengkap
  - Upload gambar berita
  - Nama editor & tanggal otomatis
  - Publish/draft status
  - Edit & hapus berita
- âœ… **Fitur Keamanan**:
  - Password visibility toggle
  - Auto-generate username dari nama
  - Auto-capitalize nama lengkap
  - Token-based authorization
  - Super admin cannot be edited/deleted

## ğŸ“‹ Tech Stack

### Backend
- **Node.js** + **Express.js**
- **MongoDB** (Database)
- **Mongoose** (ODM)
- **JWT** (Authentication)
- **Multer** (File Upload)
- **Bcrypt** (Password Hashing)

### Frontend
- **React 18** + **Vite**
- **React Router** (Routing)
- **Axios** (HTTP Client)
- **Leaflet** + **React-Leaflet** (Interactive Maps)
- **React Quill** (Rich Text Editor)
- **TailwindCSS** + **DaisyUI** (Styling)
- **Lucide React** (Icons)
- **date-fns** (Date Formatting)

## ğŸ› ï¸ Instalasi & Setup

### Prerequisites
- Node.js (v18 atau lebih baru)
- MongoDB (local atau cloud)
- Git

### 1. Clone Repository
```bash
cd d:\PETA-RAWAN-NARKOBA
```

### 2. Setup Backend

```bash
cd server
npm install
```

Edit file `.env` jika perlu:
```env
PORT=5000
MONGODB_URI=mongodb://localhost:27017/peta-rawan-narkoba
JWT_SECRET=your_jwt_secret_key_change_this_in_production
NODE_ENV=development
```

### 3. Setup Frontend

```bash
cd ../client
npm install
```

### 4. Jalankan Aplikasi

#### Terminal 1 - Backend:
```bash
cd server
npm run dev
```
Server akan berjalan di: http://localhost:5000

#### Terminal 2 - Frontend:
```bash
cd client
npm run dev
```
Client akan berjalan di: http://localhost:3000

## ğŸ‘¤ Setup Super Admin Pertama Kali

âš ï¸ **PENTING**: Aplikasi ini menggunakan sistem Super Admin dengan KTP sebagai primary key.

### Credentials Super Admin Default:
- **NIK/KTP:** 1308162101990001
- **Username:** admin
- **Password:** Set via `SUPER_ADMIN_PASSWORD` or generated by `createAdmin.js`
- **Nama:** MUHAMAD FADLI

### Membuat Super Admin:

#### Cara 1: Menggunakan Script (RECOMMENDED)
```bash
cd server
node createAdmin.js
```

#### Cara 2: Manual Migration (Jika sudah ada data admin lama)
```bash
cd server
node migrateAdmin.js  # Migrate data lama
node server.js        # Restart server
```

Note: When running the server in development (`NODE_ENV=development`), the backend will auto-seed a default logo, banner, sample location, example news, and a super admin user when the database is empty. Use `SUPER_ADMIN_PASSWORD` environment variable to set the dev super admin password or check console output for the generated one.

### Seeding Dev Data
You can seed the database with example data for local development (logo, banner, location, news, and a dev super admin):

```bash
cd server
npm run seed:dev
```

If you prefer to set a known password for the dev super admin, set `SUPER_ADMIN_PASSWORD` before running the seed command.
### Hak Akses Super Admin:
- âœ… Menambah admin baru
- âœ… Edit admin lain (kecuali super admin sendiri)
- âœ… Reset password admin lain
- âœ… Delete admin lain (kecuali super admin sendiri)
- âœ… Kelola semua konten (banner, logo, lokasi, berita)

### Menambah Admin Baru:
**Hanya Super Admin yang dapat melakukan ini!**
1. Login as super admin using the username and password you created with `createAdmin.js` or set with `SUPER_ADMIN_PASSWORD`.
2. Buka menu "Kelola Admin"
3. Klik "Tambah Admin"
4. Isi form:
   - **Nama Lengkap** (auto-capitalize)
   - **Nomor KTP** (16 digit)
   - **Username** (auto-generate dari nama)
   - **Password** (minimal 6 karakter)
5. Klik "Simpan"

âš ï¸ **CATATAN KEAMANAN:**
- Super admin (KTP: 1308162101990001) tidak dapat diedit atau dihapus via interface
- Semua operasi admin management memerlukan token super admin
- Nomor KTP menjadi unique identifier dan tidak dapat diubah setelah dibuat

## ğŸ“± Cara Menggunakan

### Login Admin
1. Buka http://localhost:3000/admin/login
2. Login dengan username dan password yang sudah dibuat
3. Akses dashboard admin

### Update Banner
1. Pilih menu "Banner" di sidebar
2. Upload gambar baru (max 5MB)
3. Edit caption dan lokasi
4. Klik "Upload Banner Baru"

### Update Logo BNN
1. Pilih menu "Logo BNN"
2. Upload logo baru (max 2MB)
3. Edit title dan subtitle
4. Klik "Upload Logo Baru"

### Tambah Titik Lokasi
1. Pilih menu "Titik Lokasi"
2. Klik "Tambah Lokasi"
3. Pilih koordinat dengan 3 cara:
   - **Klik di Peta**: Aktifkan mode klik, lalu klik di peta
   - **Gunakan GPS**: Klik tombol GPS (perlu izin browser)

## ğŸ”– Favicon
- **Lokasi file:** letakkan file favicon di `client/public/`.
- **Nama file yang digunakan:** `favicon.svg` (utama), `favicon.ico` (fallback), `site.webmanifest` (opsional).
- **Ganti ikon:** Sistem sekarang mencoba menggunakan logo aktif dari database sebagai favicon secara otomatis (endpoint `/api/logo/active`). Jika Anda ingin memakai file statis khusus, kirim file (SVG/PNG/ICO) dan saya akan masukkan ke `client/public/` dan update referensi di `client/index.html`.


  ## ğŸ“¦ Deploy Frontend to Vercel

  - Connect your GitHub repository to Vercel and create a new project for the `client` folder.
  - Project settings:
    - Root directory: `client`
    - Build Command: `npm run build`
    - Output Directory: `dist`
  - Environment Variables (add in Vercel dashboard):
    - `VITE_API_BASE` = `https://<your-railway-app>.up.railway.app/api` (replace with your actual API URL)
  - Ensure CORS: if you set `ALLOWED_ORIGINS` on the server, include the Vercel URL so API accepts requests from the deployed frontend.

  After deployment, check the Vercel project logs for build success and verify the frontend can call the API endpoints.
   - **Input Manual**: Ketik langsung latitude & longitude
4. Pilih kelurahan (warna otomatis)
5. Isi kecamatan, alamat, deskripsi
6. Atur jumlah kasus
7. Klik "Simpan Lokasi"

### Tambah Berita
1. Pilih menu "Kelola Berita"
2. Klik "Tambah Berita"
3. Upload gambar berita (max 5MB)
4. Isi judul berita
5. Isi nama editor
6. Tulis isi berita dengan rich text editor:
   - Format teks (bold, italic, underline)
   - Heading (H1-H6)
   - List (ordered/unordered)
   - Link, gambar, video
   - Warna teks & background
   - Dan lainnya
7. Centang "Publikasikan Berita" jika ingin langsung publish
8. Klik "Simpan Berita"

## ğŸ—ºï¸ Data Kelurahan Tanjungpinang

Aplikasi sudah include 10 kelurahan dengan warna berbeda:
1. Tanjungpinang Kota (Merah)
2. Tanjungpinang Barat (Hijau)
3. Tanjungpinang Timur (Biru)
4. Bukit Bestari (Pink)
5. Kampung Bugis (Kuning)
6. Batu IX (Cyan)
7. Pinang Kencana (Orange)
8. Air Raja (Purple)
9. Senggarang (Light Green)
10. Dompak (Dark Red)

## ğŸ“‚ Struktur Folder

```
PETA-RAWAN-NARKOBA/
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ models/          # Database models
â”‚   â”œâ”€â”€ routes/          # API routes
â”‚   â”œâ”€â”€ middleware/      # Auth & upload middleware
â”‚   â”œâ”€â”€ uploads/         # Upload directory
â”‚   â”œâ”€â”€ server.js        # Main server file
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ client/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ components/  # Reusable components
    â”‚   â”œâ”€â”€ pages/       # Page components
    â”‚   â”‚   â”œâ”€â”€ admin/   # Admin pages
    â”‚   â”‚   â””â”€â”€ ...      # Public pages
    â”‚   â”œâ”€â”€ services/    # API services
    â”‚   â”œâ”€â”€ utils/       # Utility functions
    â”‚   â”œâ”€â”€ App.jsx      # Main app component
    â”‚   â””â”€â”€ main.jsx     # Entry point
    â”œâ”€â”€ public/
    â””â”€â”€ package.json
```

## ğŸ”’ Security Notes

âš ï¸ **PENTING untuk Production:**

1. Ganti `JWT_SECRET` di `.env` dengan string random yang kuat
2. Setup HTTPS untuk production
3. Gunakan MongoDB cloud (MongoDB Atlas) untuk production
4. Set `NODE_ENV=production`
5. Implement rate limiting untuk API
6. Add CORS whitelist untuk domain production

## ğŸ› Troubleshooting

### Port sudah digunakan
```bash
# Windows PowerShell - Kill process on port 5000
Get-Process -Id (Get-NetTCPConnection -LocalPort 5000).OwningProcess | Stop-Process -Force

# Kill process on port 3000
Get-Process -Id (Get-NetTCPConnection -LocalPort 3000).OwningProcess | Stop-Process -Force
```

### MongoDB Connection Error
- Pastikan MongoDB service berjalan
- Cek connection string di `.env`
- Untuk MongoDB local: `mongodb://localhost:27017/peta-rawan-narkoba`

### Upload tidak berfungsi
- Pastikan folder `server/uploads` exist
- Cek permission folder
- Cek max file size di middleware

### Map tidak muncul
- Cek koneksi internet (map tiles dari OSM)
- Buka browser console untuk error
- Pastikan Leaflet CSS ter-load

## ğŸ“ API Endpoints

### Public Endpoints
- `GET /api/banner/active` - Get active banner
- `GET /api/logo/active` - Get active logo
- `GET /api/locations` - Get all locations
- `GET /api/locations/statistics` - Get statistics by kelurahan
- `GET /api/news` - Get all news (paginated)
- `GET /api/news/:id` - Get single news

### Admin Endpoints (Require Auth)
- `POST /api/auth/login` - Admin login
- `POST /api/banner` - Upload banner
- `PATCH /api/banner/:id` - Update caption
- `POST /api/logo` - Upload logo
- `POST /api/locations` - Create location
- `PUT /api/locations/:id` - Update location
- `DELETE /api/locations/:id` - Delete location
- `POST /api/news` - Create news
- `PUT /api/news/:id` - Update news
- `DELETE /api/news/:id` - Delete news

## ğŸ“§ Support

Untuk pertanyaan atau bantuan:
- Email: bnnkota.tanjungpinang@gmail.com
- Telepon: +62 822-7549-5694

## ğŸ“„ License

Â© 2025 BNN Kota Tanjungpinang. All rights reserved.